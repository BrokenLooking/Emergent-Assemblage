<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emergent Assemblage</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.min.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden;
      background: black; color: #00ffcc;
      font-family: monospace;
    }
    #quote {
      position: absolute;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      font-size: 1.4em;
      text-align: center;
      z-index: 10;
    }
    #startOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.95);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="startOverlay">Click to activate the assemblage</div>
  <div id="quote">Initializing...</div>

  <!-- Audio Element -->
  <audio id="background-audio" preload="auto" loop>
    <source src="emergenttrack2.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <script>
    // Fragments
    const fragments = [
      "How does a gathering become a happening?",
      "Greater than the sum of its parts?",
      "One answer is contamination.",
      "Polyphony is music in which autonomous melodies intertwine.",
      "Poetics suggests life without what we think we need.",
      "Transformation through encounter.",
      "Letting go of control.",
      "Shifting hope toward action not born of desperation.",
      "Desire becomes design.",
      "You are always being made gently.",
      "You are always being unmade slowly.",
      "Technology is a traitorous saviour.",
      "The machine is dreaming.",
      "Tangled in signal.",
      "Data is growing teeth.",
      "Signal lost in velvet static.",
      "Uncertainty works in multiple ways."
    ];

    let weatherData = "üåç Weather unknown";

    function getEntangledQuote() {
      const shuffled = [...fragments].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, Math.floor(3 + Math.random() * 3)).join(" ");
    }

    function updateQuote() {
      document.getElementById("quote").innerText = `${getEntangledQuote()}\n\n${weatherData}`;
    }

    setInterval(updateQuote, 10000);
    updateQuote();

    // Optional: Add OpenWeatherMap API key here
    // const apiKey = "YOUR_KEY";
    // navigator.geolocation.getCurrentPosition(pos => {
    //   fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&appid=${apiKey}&units=metric`)
    //     .then(res => res.json())
    //     .then(data => {
    //       const temp = data.main.temp;
    //       const desc = data.weather[0].description;
    //       weatherData = `üå¶Ô∏è ${temp}¬∞C, ${desc}`;
    //       updateQuote();
    //     });
    // });

    // Particle visuals
    let particles = [];

    function setup() {
      createCanvas(windowWidth, windowHeight);
      for (let i = 0; i < 150; i++) {
        particles.push({
          x: random(width),
          y: random(height),
          vx: random(-0.5, 0.5),
          vy: random(-0.5, 0.5),
          size: random(1, 4)
        });
      }
    }

    function draw() {
      background(0, 10);
      noStroke();
      fill(0, 255, 204, 100);
      for (let p of particles) {
        ellipse(p.x, p.y, p.size);
        p.x += p.vx;
        p.y += p.vy;
        if (p.x < 0 || p.x > width) p.vx *= -1;
        if (p.y < 0 || p.y > height) p.vy *= -1;
      }

      const audio = document.getElementById('background-audio');
      if (audio && !audio.paused) {
        let speed = map(mouseX, 0, width, 0.5, 2.0);
        audio.playbackRate = constrain(speed, 0.5, 2.0);
      }
    }

    document.getElementById('startOverlay').addEventListener('click', () => {
      const audio = document.getElementById('background-audio');
      audio.play().then(() => {
        document.getElementById('startOverlay').style.display = 'none';
      }).catch(err => {
        alert(\"Autoplay blocked: click again or use the audio controls.\");
        console.error(err);
      });
    });
  </script>
</body>
</html>
